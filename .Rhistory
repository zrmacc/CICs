#   device = "png",
#   width = 3,
#   height = 1.5,
#   units = "cm",
#   scale = 6,
#   dpi = 360
# )
# Note: When applicable, annotate white-space of plots with survival curve comparisons.
#------------------------------------------------------------------------------
# RMST
#------------------------------------------------------------------------------
# Note: set truncation time.
# Asymptotic analysis.
rmst_analysis = rmst2(
time = data$time,
status = data$status, arm = data$arm,
tau = 18,
alpha = 0.05
)
show(rmst_analysis)
se <- sqrt(
rmst_analysis$RMST.arm0$rmst.var +rmst_analysis$RMST.arm1$rmst.var
)
# Analysis via perturbation.
two_sample_comparison = surv2sample(
time = data$time,
status = data$status,
arm = data$arm,
timepoints = 18,
quanprobs = 0.5,
tau = 18,
SEED = 102,
npert = 2000
)
two_sample_comparison
two_sample_comparison$contrast.diff10
(.3543022-0.190255)/1.96
se
# Purpose: Analysis template.
# Updated:
source('/Users/zmccaw/Documents/Lab/Survival/Rscripts/Functions.R')
# Directory
setwd("~/Documents/Lab/Survival/2020 Gandhi/")
#------------------------------------------------------------------------------
# Inputs
#------------------------------------------------------------------------------
# Notes:
# Set upper time limit.
# Obtain NARs.
# Lower and upper time limits.
L <- 0
U <- 21
## Delta between time points.
d <- 3
times <- seq(from = L, to = U, by = d)
# Input files.
fin_ctrl <- "Data/tps3_ctrl.txt"
fin_trt  <- "Data/tps3_trt.txt"
# Numbers at risk
nar_trt  <- c(132, 122, 114, 96, 56, 25, 6, 0)
nar_ctrl <- c(70, 64, 50, 35, 19, 13, 4, 0)
# Ctrl
data_ctrl <- Reconstruct(fin_ctrl, nar_ctrl, times, arm = 0, tau = U)
data_ctrl[70, 2] <- 19
# Treatment
data_trt <- Reconstruct(fin_trt, nar_trt, times, arm = 1, tau = U)
data_trt[132, 2] <- 19
# Overall
data <- rbind(data_ctrl, data_trt)
#------------------------------------------------------------------------------
# Log rank test
#------------------------------------------------------------------------------
log_rank <- survdiff(Surv(data$time, data$status) ~ data$arm)
show(log_rank)
#------------------------------------------------------------------------------
# Fit Parametric Model
#------------------------------------------------------------------------------
# Weibull model
para_model <- compParaSurv(
time = data$time,
status = data$status,
arm = data$arm,
dist1 = "weibull")
show(para_model)
#------------------------------------------------------------------------------
# Hazard ratio
#------------------------------------------------------------------------------
hr <- HazardRatio(data)
show(hr)
#------------------------------------------------------------------------------
# Plotting
#------------------------------------------------------------------------------
# Axes labels
x_lab = 'Months'
y_lab = 'OS'
# Colors
ctrl_color <- rgb(198, 88, 66, maxColorValue = 255)
trt_color <- rgb(99, 133, 184, maxColorValue = 255)
# Survival curves
q <- PlotSurvData(
data,
tau = U,
para_model,
survival = TRUE,
ctrl_label = 'Ctrl',
ctrl_color = ctrl_color,
trt_label = 'Trt',
trt_color = trt_color
)
q = q + theme(legend.position = c(0.8, 0.8))
q = q + scale_x_continuous(
name = x_lab,
breaks = seq(from = 0, to = U, by=d),
limits = c(L - 0.05, U + 0.05)
)
q = q + scale_y_continuous(
name = y_lab,
breaks = seq(from = 0.0, to = 1.0, by = 0.1),
limits=c(0.0, 1.0)
)
show(q)
q2 = q
# fout = 'Plots/OS.km_cuves.png'
# ggsave(
#   plot = q,
#   filename = fout,
#   device = "png",
#   width = 3,
#   height = 1.5,
#   units = "cm",
#   scale = 4,
#   dpi = 360
# )
# Cumulative hazards plot
q = PlotCumHazards(data)
# fout = 'Plots/OS.cum_haz.png'
# ggsave(
#   plot = q,
#   filename = fout,
#   device = "png",
#   width = 3,
#   height = 1.5,
#   units = "cm",
#   scale = 6,
#   dpi = 360
# )
# Note: When applicable, annotate white-space of plots with survival curve comparisons.
#------------------------------------------------------------------------------
# RMST
#------------------------------------------------------------------------------
# Note: set truncation time.
# Asymptotic analysis.
rmst_analysis = rmst2(
time = data$time,
status = data$status, arm = data$arm,
tau = 18,
alpha = 0.05
)
show(rmst_analysis)
se <- sqrt(
rmst_analysis$RMST.arm0$rmst.var +rmst_analysis$RMST.arm1$rmst.var
)
# Analysis via perturbation.
two_sample_comparison = surv2sample(
time = data$time,
status = data$status,
arm = data$arm,
timepoints = 18,
quanprobs = 0.5,
tau = 18,
SEED = 102,
npert = 2000
)
two_sample_comparison$contrast.diff10
se
(0.4246042-0.2715798)/1.96
# Purpose: Analysis template.
# Updated:
source('/Users/zmccaw/Documents/Lab/Survival/Rscripts/Functions.R')
# Directory
setwd("~/Documents/Lab/Survival/2020 Gandhi/")
#------------------------------------------------------------------------------
# Inputs
#------------------------------------------------------------------------------
# Notes:
# Set upper time limit.
# Obtain NARs.
# Lower and upper time limits.
L <- 0
U <- 21
## Delta between time points.
d <- 3
times <- seq(from = L, to = U, by = d)
# Input files.
fin_ctrl <- "Data/os_ctrl.txt"
fin_trt  <- "Data/os_trt.txt"
# Numbers at risk
nar_trt  <- c(410, 377, 347, 278, 163, 71, 18, 0)
nar_ctrl <- c(206, 183, 149, 104, 59, 25, 8, 0)
# Ctrl
data_ctrl <- Reconstruct(fin_ctrl, nar_ctrl, times, arm = 0, tau = U)
# Treatment
data_trt <- Reconstruct(fin_trt, nar_trt, times, arm = 1, tau = U)
# Overall
data <- rbind(data_ctrl, data_trt)
#------------------------------------------------------------------------------
# Log rank test
#------------------------------------------------------------------------------
log_rank <- survdiff(Surv(data$time, data$status) ~ data$arm)
show(log_rank)
#------------------------------------------------------------------------------
# Fit Parametric Model
#------------------------------------------------------------------------------
# Weibull model
para_model <- compParaSurv(
time = data$time,
status = data$status,
arm = data$arm,
dist1 = "weibull")
show(para_model)
#------------------------------------------------------------------------------
# Hazard ratio
#------------------------------------------------------------------------------
hr <- HazardRatio(data)
show(hr)
#------------------------------------------------------------------------------
# Plotting
#------------------------------------------------------------------------------
# Axes labels
x_lab = 'Months'
y_lab = 'OS'
# Colors
ctrl_color <- rgb(198, 88, 66, maxColorValue = 255)
trt_color <- rgb(99, 133, 184, maxColorValue = 255)
# Survival curves
q <- PlotSurvData(
data,
tau = U,
para_model,
survival = TRUE,
ctrl_label = 'Ctrl',
ctrl_color = ctrl_color,
trt_label = 'Trt',
trt_color = trt_color
)
q = q + theme(legend.position = c(0.8, 0.8))
q = q + scale_x_continuous(
name = x_lab,
breaks = seq(from = 0, to = U, by=d),
limits = c(L - 0.05, U + 0.05)
)
q = q + scale_y_continuous(
name = y_lab,
breaks = seq(from = 0.0, to = 1.0, by = 0.1),
limits=c(0.0, 1.0)
)
show(q)
q2 = q
# fout = 'Plots/OS.km_cuves.png'
# ggsave(
#   plot = q,
#   filename = fout,
#   device = "png",
#   width = 3,
#   height = 1.5,
#   units = "cm",
#   scale = 4,
#   dpi = 360
# )
# Cumulative hazards plot
q = PlotCumHazards(data)
# fout = 'Plots/OS.cum_haz.png'
# ggsave(
#   plot = q,
#   filename = fout,
#   device = "png",
#   width = 3,
#   height = 1.5,
#   units = "cm",
#   scale = 6,
#   dpi = 360
# )
# Note: When applicable, annotate white-space of plots with survival curve comparisons.
#------------------------------------------------------------------------------
# RMST
#------------------------------------------------------------------------------
# Note: set truncation time.
# Asymptotic analysis.
rmst_analysis = rmst2(
time = data$time,
status = data$status,
arm = data$arm,
tau = 18,
alpha = 0.05
)
show(rmst_analysis)
se <- sqrt(
rmst_analysis$RMST.arm0$rmst.var +rmst_analysis$RMST.arm1$rmst.var
)
# Analysis via perturbation.
two_sample_comparison = surv2sample(
time = data$time,
status = data$status,
arm = data$arm,
timepoints = 18,
quanprobs = 0.5,
tau = 18,
SEED = 102,
npert = 2000
)
se
rmst_analysis$unadjusted.result
two_sample_comparison
two_sample_comparison$contrast.diff10
(0.2977245-0.1980237)/1.96
metamean
? metamean
? meta
metagen
? metagen
metagen(
TE = rmsts,
seTE = c(0.9906541, 0.9618297, 0.9359645)
)
# RMSTs
rmsts <- c(2.1305367, 2.0658168, 3.3354444)
rmst_ses <- c(0.9906541, 0.9618297, 0.9359645)
metagen(
TE = rmsts,
seTE = c(0.9906541, 0.9618297, 0.9359645)
)
# 18-day rates
rates <- c(0.1075928, 0.190255, 0.2715798)
rates_ses <- c(0.09099469, 0.08369755, 0.07807367)
rmst_meta <- metagen(
TE = rmsts,
seTE = c(0.9906541, 0.9618297, 0.9359645)
)
rmst_meta$seTE.fixed
rmst_meta$pval.fixed
rates_meta <- metagen(
TE = rates,
seTE = rates_ses
)
rates_meta$pval.fixed
rates_meta$TE.fixed
rates_meta$seTE.fixed
rates_meta
rates_meta$pval.fixed
# Purpose: Analysis template.
# Updated:
source('/Users/zmccaw/Documents/Lab/Survival/Rscripts/Functions.R')
# Directory
setwd("~/Documents/Lab/Survival/2020 Gandhi/")
#------------------------------------------------------------------------------
# Inputs
#------------------------------------------------------------------------------
# Notes:
# Set upper time limit.
# Obtain NARs.
# Lower and upper time limits.
L <- 0
U <- 21
## Delta between time points.
d <- 3
times <- seq(from = L, to = U, by = d)
# Input files.
fin_ctrl <- "Data/os_ctrl.txt"
fin_trt  <- "Data/os_trt.txt"
# Numbers at risk
nar_trt  <- c(410, 377, 347, 278, 163, 71, 18, 0)
nar_ctrl <- c(206, 183, 149, 104, 59, 25, 8, 0)
# Ctrl
data_ctrl <- Reconstruct(fin_ctrl, nar_ctrl, times, arm = 0, tau = U)
# Treatment
data_trt <- Reconstruct(fin_trt, nar_trt, times, arm = 1, tau = U)
# Overall
data <- rbind(data_ctrl, data_trt)
#------------------------------------------------------------------------------
# Log rank test
#------------------------------------------------------------------------------
log_rank <- survdiff(Surv(data$time, data$status) ~ data$arm)
show(log_rank)
#------------------------------------------------------------------------------
# Fit Parametric Model
#------------------------------------------------------------------------------
# Weibull model
para_model <- compParaSurv(
time = data$time,
status = data$status,
arm = data$arm,
dist1 = "weibull")
show(para_model)
#------------------------------------------------------------------------------
# Hazard ratio
#------------------------------------------------------------------------------
hr <- HazardRatio(data)
show(hr)
#------------------------------------------------------------------------------
# Plotting
#------------------------------------------------------------------------------
# Axes labels
x_lab = 'Months'
y_lab = 'OS'
# Colors
ctrl_color <- rgb(198, 88, 66, maxColorValue = 255)
trt_color <- rgb(99, 133, 184, maxColorValue = 255)
# Survival curves
q <- PlotSurvData(
data,
tau = U,
para_model,
survival = TRUE,
ctrl_label = 'Ctrl',
ctrl_color = ctrl_color,
trt_label = 'Trt',
trt_color = trt_color
)
q = q + theme(legend.position = c(0.8, 0.8))
q = q + scale_x_continuous(
name = x_lab,
breaks = seq(from = 0, to = U, by=d),
limits = c(L - 0.05, U + 0.05)
)
q = q + scale_y_continuous(
name = y_lab,
breaks = seq(from = 0.0, to = 1.0, by = 0.1),
limits=c(0.0, 1.0)
)
show(q)
q2 = q
# fout = 'Plots/OS.km_cuves.png'
# ggsave(
#   plot = q,
#   filename = fout,
#   device = "png",
#   width = 3,
#   height = 1.5,
#   units = "cm",
#   scale = 4,
#   dpi = 360
# )
# Cumulative hazards plot
q = PlotCumHazards(data)
# fout = 'Plots/OS.cum_haz.png'
# ggsave(
#   plot = q,
#   filename = fout,
#   device = "png",
#   width = 3,
#   height = 1.5,
#   units = "cm",
#   scale = 6,
#   dpi = 360
# )
# Note: When applicable, annotate white-space of plots with survival curve comparisons.
#------------------------------------------------------------------------------
# RMST
#------------------------------------------------------------------------------
# Note: set truncation time.
# Asymptotic analysis.
rmst_analysis = rmst2(
time = data$time,
status = data$status,
arm = data$arm,
tau = 18,
alpha = 0.05
)
show(rmst_analysis)
se <- sqrt(
rmst_analysis$RMST.arm0$rmst.var +rmst_analysis$RMST.arm1$rmst.var
)
# Analysis via perturbation.
two_sample_comparison = surv2sample(
time = data$time,
status = data$status,
arm = data$arm,
timepoints = 18,
quanprobs = 0.5,
tau = 18,
SEED = 102,
npert = 2000
)
two_sample_comparison$contrast.diff10
library(CICs)
data <- readRDS(file = 'Data/stratified.rds')
marg <- CompareCICs(
time = data$time,
status = data$status,
arm = data$arm,
strata = data$stratum,
sum_stat = "AOC",
param = 18
)
auc_marg <- marg
auc_marg
# Add library path
library(devtools)
library(roxygen2)
# Creates package
setwd("~/Documents/Lab/Packages/CICs/CICs")
# devtools::create(path = 'CICs')
# Use cpp
# pkgbuild::compile_dll(force = TRUE)
## Documents package
devtools::document()
# Install
setwd("..")
devtools::install(pkg="CICs", reload = TRUE)
setwd("CICs/")
# Check package
# devtools::check()
